
<link rel="stylesheet" type="text/css" href="css/component.css" />

<!-- <b><a href=http://www.w3schools.com/tags/ref_canvas.asp target=1>
<big>HTML5 Canvas Reference is here</big></a></b> -->

<body bgcolor=black>
   <div id="div1">
      <nav class = "cl-effect-21">
         <a href="graphics.html" class="active"> Back to Graphics Projects</a>
      </nav>
      <br><br><br><br>
      <center>
         <p style="color: white;"> The purple fan. Working with parametric surfaces. Click to add ripples!</p>
         <td><canvas id='canvas1' width=500 height=500></canvas></td>
      </center>
   </div>
</body>

<script src=utility.js></script>
<script src=drawlib2.js></script>
<script src=matrix.js></script>

<script>
   var canvas;

   var matrix;
   var fanMatrix = new Matrix();
   var torusMatrix = new Matrix();
   var spiralMatrix = new Matrix();

   var pt0 = new Vector3(-1, 0, 0);
   var pt1 = new Vector3( 1, 0, 0);
   var tmp = new Vector3( 0, 0, 0);

   var pix0 = new Vector3(0, 0, 0);
   var pix1 = new Vector3(0, 0, 0);

   function moveTo(p) {
      pt0.set(p[0], p[1], p[2]);
      matrix.transform(pt0, tmp);
      tmp.viewportTransform(width, height, pix0);
      g.moveTo(pix0.x, pix0.y);
   }

   function lineTo(p) {
      pt0.set(p[0], p[1], p[2]);
      matrix.transform(pt0, tmp);
      tmp.viewportTransform(width, height, pix0);
      g.lineTo(pix0.x, pix0.y);
   }

   function drawDot(x, y, z) {
      g.beginPath();
      moveTo(x, y, z);
      lineTo(x, y, z + .001);
      g.stroke();
   }    

   function drawUnitSquare() {
      g.beginPath();
      moveTo(-1,-1, 0);
      lineTo( 1,-1, 0);
      lineTo( 1, 1, 0);
      lineTo(-1, 1, 0);
      lineTo(-1,-1, 0);
      g.strokeStyle = 'black';
      g.lineWidth = 16;
      g.stroke();
   }

   var g;
   var width;
   var height;

   canvas = initCanvas('canvas1');
   canvas.update = function(_g) {
      g = _g;
      width = canvas.width;
      height = canvas.height;

      // OUTLINE AROUND CANVAS

      g.lineWidth = 2;
      g.strokeStyle = 'white';
      g.beginPath();
      g.moveTo(0, 0);
      g.lineTo(width, 0);
      g.lineTo(width, height);
      g.lineTo(0, height);
      g.lineTo(0, 0);
      g.stroke();

      fanMatrix.identity();
      fanMatrix.scale(.4);
      fanMatrix.perspective(0, 0, .15);
      fanMatrix.translate(.1,1.4,0);
      fanMatrix.rotateY(time);

      torusMatrix.identity();
      torusMatrix.scale(.4);
      torusMatrix.translate(-.9, -1.2 + Math.sin(time), 0);
      torusMatrix.rotateX(1.3);

      spiralMatrix.identity();
      spiralMatrix.scale(.2);
      spiralMatrix.translate(.5,0,0);
      spiralMatrix.rotateX(1.5);


      g.lineJoin = 'round';
      g.lineCap = 'round';

      function tube(u, v) {
         var theta = 2 * Math.PI * u;
         var phi   = 2 * Math.PI * v;
         var radius = 1;
         return [ radius * Math.cos(theta),
                  radius * Math.sin(theta),
	               2 * v - 1
                ];
      }

      function globe(u, v) {
         var theta = 2 * Math.PI * u;
         var phi   = Math.PI * (v - .5);
	      var radius = Math.cos(phi);
	     //radius *= 1 + .1 * Math.sin(30 * (v + .3 * time));
	     //radius *= 1 + .1 * Math.sin(40 * (u + .2 * time));
         return [ radius * Math.cos(theta),
	               radius * Math.sin(theta),
	               Math.sin(phi)
	             ];
      }

      function torus(u, v, object) {
         var r = 0.2;

         //r *= 1 + .1 * Math.sin(2 * Math.PI *  7 * (v + .3 * time));

         if(object.cursor.z == 1){
            r *= 1 + .1 * Math.sin(2 * Math.PI * 10 * (u + .2 * time));
         }

         var theta = 2 * Math.PI * u;
         var phi   = 2 * Math.PI * v;
         return [ Math.cos(theta) * (1 + r * Math.cos(phi)),
	               Math.sin(theta) * (1 + r * Math.cos(phi)),
	               r * Math.sin(phi) 
                  //+ Math.sin(object.cursor.x)
	              ];
      }


      function cone(u, v) {
         var theta = 2 * Math.PI * u;
         var phi   = Math.PI * (v - .5);
         var radius = Math.cos(phi);
        //radius *= 1 + .1 * Math.sin(30 * (v + .3 * time));
        //radius *= 1 + .1 * Math.sin(40 * (u + .2 * time));
         return [ radius * Math.sin(theta) ,
                  radius * Math.cos(theta),
                  radius
                ];
      }


      function fan(u, v, object) {
         var theta = 2 * Math.PI * u;
         var phi   = Math.PI * (v - .5);
         var radius = Math.cos(theta) * Math.sin(phi);
         if(object.cursor.z == 1){
            radius *= 1 + .1 * Math.sin(30 * (v + .3 * time));
         }
        //radius *= 1 + .1 * Math.sin(40 * (u + .2 * time));
         return [ radius * Math.cos(theta),
                  radius * Math.sin(theta) ,
                  radius
                ];
      }

      function spiral(u, v, object) {
         var theta = 2 * Math.PI * u;
         var phi   = Math.PI * (v - .5);
         var radius = phi * theta / 10;

         if(object.cursor.z == 1){
            radius *= 1 + .1 * Math.sin(30 * (v + .3 * time));
         }
        //radius *= 1 + .1 * Math.sin(40 * (u + .2 * time));
         return [ radius * Math.cos(theta) + Math.sin(time),
                  radius * Math.sin(theta)  + Math.cos(time),
                  radius 
                ];
      }



      var nv = 60;
      var nu = 2 * nv;

      g.lineWidth = 1;
      for (var u = 0 ; u < 1 ; u += 1 / nu)
      for (var v = 0 ; v < 1 ; v += 1 / nv) {

         g.strokeStyle = "#4d0066";
         matrix = fanMatrix;
         g.beginPath();
         moveTo(fan(u, v, this));
         lineTo(fan(u + 1 / nu, v, this));
         g.stroke();

         g.strokeStyle = "#66ff33";
         matrix = torusMatrix;
         g.beginPath();
   	   moveTo(torus(u, v, this));
         lineTo(torus(u+1 / nu, v, this));
         g.stroke();

         g.strokeStyle = "#00ffff";
         matrix = spiralMatrix;
         g.beginPath();
         moveTo(spiral(u, v, this));
         lineTo(spiral(u+1 / nu, v, this));
         g.stroke();

      }
   }
</script>

